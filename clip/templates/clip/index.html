<!DOCTYPE html>
{% load staticfiles %}
<html>
    <head>
        <link rel='stylesheet' href='{% static "clip/bootstrap/css/bootstrap.min.css" %}'>
        <link rel='stylesheet' href='{% static "clip/font-awesome/css/font-awesome.min.css" %}'>
        <script type='text/javascript' src='{% static "clip/js/jquery-1.11.0.min.js" %}' ></script>
        <script type='text/javascript' src='{% static "clip/bootstrap/js/bootstrap.min.js" %}' ></script>
    </head>
    <body>
        <div class='container' style='padding-top:10px'>
            <form class='form-inline' action='{% url "clip:submit" %}' role='form' method='post'>{% csrf_token %}
                <fieldset>
                <div class='panel panel-primary'>
                    <div class='panel-heading'>进行选择</div>
                    <!-- Table -->
                    <table class='table table-striped table-hover'>
                        <thead>
                            <tr>
                                <th style='width:3%'>#</th>
                                <th style='width:22%'>样式</th>
                                <th style='width:15%'>数量</th>
                                <th style='width:60%'>尺寸</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for window in windows %}
                            <tr>
                                <td>{{ window.id }}</td>
                                <td>{{ window.name }}</td>
                                <td>
                                    <div class='form-group'>
                                        <div class='input-group'>
                                            <span class='input-group-btn'>
                                                <button class='btn btn-danger clip-num-btn' type='button'>数量</button>
                                            </span>
                                            <input type='number' min='0' class='form-control clip-num' name='num_{{ window.id }}' disabled required>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class='form-group col-xs-3'>
                                        <div class='input-group'>
                                            <span class='input-group-addon'>x</span>
                                            <input type='number' min='0' step=0.01 class='form-control' name='x_{{ window.id }}' disabled required>
                                        </div>
                                    </div>
                                    <div class='form-group col-xs-3'>
                                        <div class='input-group'>
                                            <span class='input-group-addon'>y</span>
                                            <input type='number' min='0' step=0.01 class='form-control' name='y_{{ window.id }}' disabled required>
                                        </div>
                                    </div>
                                    {% if window.need_m %}
                                    <div class='form-group col-xs-3'>
                                        <div class='input-group'>
                                            <span class='input-group-addon'>m</span>
                                            <input type='number' min='0' step=0.01 class='form-control' name='m_{{ window.id }}' disabled required>
                                        </div>
                                    </div>
                                    {% endif %}
                                    {% if window.need_z %}
                                    <div class='form-group col-xs-3'>
                                        <div class='input-group'>
                                            <span class='input-group-addon'>z</span>
                                            <input type='number' min='0' step=0.01 class='form-control' name='z_{{ window.id }}' disabled required>
                                        </div>
                                    </div>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                            <tr>
                                <td colspan=4 class='text-right info'>
                                    <h4>
                                        总计：<span id='clip-total-num'>0</span> 件
                                    </h4>
                                </td>
                            </tr>
                            <tr>
                                <td colspan=4 class='text-center'>
                                    <button type='submit' class='btn btn-primary btn-lg '>提交</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </fieldset>
            </form>
        </div>
        <script>
            $(function(){
                $('.clip-num-btn').click(function(){
                    var $this = $(this);
                    var $tr = $this.parents('tr');
                    $tr.find('input').prop('disabled', !$this.hasClass('btn-danger'));
                    $tr.toggleClass('success');
                    $this.toggleClass('btn-success btn-danger');
                    $this.parent().next().focus();
                });
                $('.clip-num').focusout(function(){
                    var $this = $(this);
                    var value = parseInt($this.val());
                    if (isNaN(value)){
                        $this.focus();
                        $this.parents('.form-group').addClass('has-error');
                        return;
                    }
                    $this.parents('.form-group').removeClass('has-error');
                    var total_num = 0;
                    $('.clip-num').not(':disabled').each(function(){
                        total_num += parseInt($(this).val());
                    });
                    $('#clip-total-num').html(total_num);
                });
            });
        </script>
    </body>
</html>
