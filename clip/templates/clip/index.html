{% extends "clip/base.html" %}
{% load staticfiles %}

{% block title %}首页{% endblock %}

{% block content %}
<form class='form-inline' action='{% url "clip:submit" %}' role='form' method='post'>{% csrf_token %}
    <fieldset>
        <div class='panel panel-primary'>
            <div class='panel-heading'>进行选择</div>
            <!-- Table -->
            <table class='table table-striped table-hover index-table'>
                <thead>
                    <tr>
                        <th style='width:3%'>#</th>
                        <th style='width:12%' class='center'>样式</th>
                        <th style='width:15%'>数量</th>
                        <th style='width:70%'>尺寸</th>
                    </tr>
                </thead>
                <tbody>
                    {% for window in windows %}
                    <tr>
                        <td class='middle'>{{ window.id }}<input type='hidden' name='id_{{ window.id }}' value='@' disabled></td>
                        <td class='center'>
                            <img width='100px' height='auto' src='{% static "clip/images/" %}{{ window.id }}.png'/>
                        </td>
                        <td class='middle'>
                            <div class='form-group'>
                                <div class='input-group'>
                                    <span class='input-group-btn'>
                                        <button class='btn btn-danger clip-num-btn' type='button'>数量</button>
                                    </span>
                                    <input type='number' min='0' class='form-control clip-num' name='num_{{ window.id }}' disabled required>
                                </div>
                            </div>
                        </td>
                        <td class='middle'>
                            <div class='form-group col-xs-3'>
                                <div class='input-group'>
                                    <span class='input-group-addon'>x</span>
                                    <input type='number' min='0' step=0.01 class='form-control' name='x_{{ window.id }}' disabled required>
                                </div>
                            </div>
                            <div class='form-group col-xs-3'>
                                <div class='input-group'>
                                    <span class='input-group-addon'>y</span>
                                    <input type='number' min='0' step=0.01 class='form-control' name='y_{{ window.id }}' disabled required>
                                </div>
                            </div>
                            {% if window.need_m %}
                            <div class='form-group col-xs-3'>
                                <div class='input-group'>
                                    <span class='input-group-addon'>m</span>
                                    <input type='number' min='0' step=0.01 class='form-control' name='m_{{ window.id }}' disabled required>
                                </div>
                            </div>
                            {% endif %}
                            {% if window.need_z %}
                            <div class='form-group col-xs-3'>
                                <div class='input-group'>
                                    <span class='input-group-addon'>z</span>
                                    <input type='number' min='0' step=0.01 class='form-control' name='z_{{ window.id }}' disabled required>
                                </div>
                            </div>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                    <tr>
                        <td colspan=4 class='text-right info'>
                            <h4>
                                总计：<span id='clip-total-num'>0</span> 件
                            </h4>
                        </td>
                    </tr>
                    <tr>
                        <td colspan=4 class='text-center'>
                            <button id='submit' type='submit' class='btn btn-primary btn-lg '>提交</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </fieldset>
</form>
{% endblock %}

{% block script %}
<script>
    $(function(){
        $('.clip-num-btn').click(function(){
            var $this = $(this);
            var $tr = $this.parents('tr');
            var is_selected = !!$this.hasClass('btn-danger');
            $tr.find('input').prop('disabled', !is_selected);
            $tr.toggleClass('success');
            $this.toggleClass('btn-success btn-danger');
            if (is_selected) {
                $this.parent().next().focus();
            } 
            else {
                $this.parents('.form-group').removeClass('has-error');
            }
        });
        $('.clip-num').focusout(function(){
            var $this = $(this);
            var value = parseInt($this.val());
            if (isNaN(value) && $this.prop('disabled')){
                $this.focus();
                $this.parents('.form-group').addClass('has-error');
                return;
            }
            $this.parents('.form-group').removeClass('has-error');
            var total_num = 0;
            $('.clip-num').not(':disabled').each(function(){
                total_num += parseInt($(this).val());
            });
            $('#clip-total-num').html(total_num);
        });
        $('#submit').click(function(){
            var num_count = $('.clip-num').not(':disabled').size();
            if (num_count == 0)
            {
                alert('你还没有进行选择！');
                return false;
            }
        });
    });
</script>
{% endblock %}
